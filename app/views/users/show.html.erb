<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="user_box row">
        <div class="col-4">
          <div class="user_image-box center">
            <% if @user.image.present? %>
              <%= image_tag @user.image.info.to_s %>
            <% else %>
              <%= image_tag "no_image.png", size: "250x300" %>
            <% end %>
          </div>
          <% if user_signed_in? %>
            <div class="user_edit wid-60 ma-a pa-t-30">
              <%= link_to "編集する", edit_user_path(current_user), class:"btn btn-outline-primary wid-100" %>
            </div>
          <% end %>
        </div>
        <div class="col-8">
          <div class="user_name-box">
            <%= @user.kana_fullname %><br>
            <span class="font-30"><%= @user.fullname %></span>
          </div>
          <div class="user_info-box">
            <div class="sex">
              <p>性別：<%= @user.sex_i18n %>（満<%= @user.age %>歳）</p>
            </div>
            <div class="birthday">
              <p>生年月日：<%= @user.birthday.strftime("%Y年%m月%d日") %></p>
            </div>
            <div class="address">
              <p>
                〒<%= @user.postal_code %><br>
                <%= @user.address %>
              </p>
            </div>
            <div class="phone_number">
              <p>電話番号：<%= @user.phone_number %></p>
            </div>
            <div class="introduction">
              <p>自己紹介文</p>
              <%= @user.introduction %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="review_title">
    <h3 class="sub-title">評価</h3>
  </div>
  <% if @user.reviews.any? %>
    <div class="review_content-box row">
      <div class="col-3 pa-t-75">
        <div class="total_review">
          <h5 class="pa-30">総合評価<span class="pa-l-70"><%= @user.total_rates %></span></h5>
        </div>
        <table class="table">
          <tbody>
            <tr>
              <th scope="row">接客</th>
              <td><%= @user.service_rates %></td>
            </tr>
            <tr>
              <th scope="row">スキル</th>
              <td><%= @user.skill_rates %></td>
            </tr>
            <tr>
              <th scope="row">声の大きさ</th>
              <td><%= @user.voice_rates %></td>
            </tr>
            <tr>
              <th scope="row">真面目さ</th>
              <td><%= @user.earnest_rates %></td>
            </tr>
            <tr>
              <th scope="row">笑顔</th>
              <td><%= @user.smile_rates %></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-9">
        <canvas id="myChart"></canvas>
      </div>
    </div>
  <% else %>
    <div class="review_content-box row">
      <div class="col-3 pa-t-50">
        <p class="center">まだ評価されていません</p>
        <table class="table">
          <tbody>
            <tr>
              <th scope="row">接客</th>
              <td>-</td>
            </tr>
            <tr>
              <th scope="row">スキル</th>
              <td>-</td>
            </tr>
            <tr>
              <th scope="row">声の大きさ</th>
              <td>-</td>
            </tr>
            <tr>
              <th scope="row">真面目さ</th>
              <td>-</td>
            </tr>
            <tr>
              <th scope="row">笑顔</th>
              <td>-</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-9">
        <canvas id="myChart"></canvas>
      </div>
    </div>
  <% end %>
  <%= render "reviews/index", reviews: @reviews %>
  <div class="link right">
    <%= link_to "レビュー一覧を見る", reviews_path(user_id: @user.id) %>
  </div>
</div>

<script>
  var ctx = document.getElementById("myChart");
  var myRadarChart = new Chart(ctx, {
    type: 'radar', 
    data: { 
      labels: ["接客", "スキル", "声の大きさ", "真面目さ", "笑顔"],
      datasets: [{
        label: '評価',
        backgroundColor: 'RGBA(115,255,25, 0.5)',
        borderColor: 'RGBA(115,255,25, 1)',
        borderWidth: 1,
        data: [
          <%= @user.service_rates %>,
          <%= @user.skill_rates %>,
          <%= @user.voice_rates %>,
          <%= @user.earnest_rates %>,
          <%= @user.smile_rates %>
        ]
      }]
    },
    options: {
      title: {
        display: true,
        text: '平均評価'
      },
      scale:{
        ticks:{
          suggestedMin: 0,
          suggestedMax: 10,
          stepSize: 2,
        }
      }
    }
  });
</script>